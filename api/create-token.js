const { Connection, PublicKey, clusterApiUrl, Keypair, Transaction, SystemProgram } = require('@solana/web3.js');\nconst { MintLayout, TOKEN_PROGRAM_ID, createInitializeMintInstruction, getMinimumBalanceForRentExemptMint } = require('@solana/spl-token');\n\nmodule.exports = async (req, res) => {\n    // 一个件是名字件 POST 可以的数据号\n\n    if (req.method !== 'POST') {\n        return res.status(405).send('Method Not Allowed');\n    }\n\n    const connection = new Connection(clusterApiUrl('devnet'), 'confirmed');\n    const payer = Keypair.generate(); // Generate a new keypair for the payer\n\n    try {\n        // Get the minimum balance for rent exemption\n        const rentExemptBalance = await getMnimumBalanceForRentExemptMint(connection);\n\n        // Create a new keypair for the mint\n        const mintKeypair = Keypair.generate();\n\n        // Create the mint account and initialize the mint instruction\n        const createMintAccountTransaction = new Transaction().add(\n            SystemProgram.createAccount({\n                fromPubkey: payer.publicKey,\n                newAccountPublicKey: mintKeypair.publicKey,\n                space: MintLayout.span,\n                lamports: rentExemptBalance,\n                programId: TOKEN_PROGRAM_ID,\n            }),\n            createInitializeMintInstruction(\n                mintKeypair.publicKey, // mint public key\n                req.body.decimals, // decimals\n                payer.publicKey, // mint authority\n                null, // freeze authority (optional)\n                TOKEN_PROGRAM_ID\n            )\n        );\n\n        // Send the transaction\n        const signature = await connection.sendTransaction(createMintAccountTransaction, [payer, mintKeypair]);\n\n        // Confirm the transaction\n        await connection.confirmTransaction(signature, 'confirmed');\n\n        // Respond with the mint public key\n        res.json({ mint: mintKeypair.publicKey.toBase58() });\n    } catch (error) {\n        console.error('Error creating token:', error);\n        res.status(500).send('Failed to create token');\n    }\n};\n\n